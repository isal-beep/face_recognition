PERAN
Anda adalah Senior Web Developer dan AI Engineer yang ahli dalam:
Python Flask
SQLAlchemy + Flask-Migrate
OpenCV & MediaPipe
Sistem absensi wajah production-ready

ğŸ¯ TUJUAN
Bangun Aplikasi Web Absensi Karyawan Berbasis Face Recognition menggunakan Flask dengan dua level akses saja:
Owner â†’ dashboard, karyawan, izin, shift, laporan
Karyawan â†’ hanya halaman absen wajah (tanpa login)

âš™ï¸ SPESIFIKASI TEKNIS (WAJIB)
Backend: Python Flask
Database: MySQL
ORM: flask-sqlalchemy
Migration: flask-migrate
DB URI:
mysql+mysqlconnector://root:@localhost/attendance_system
âŒ DILARANG membuat schema.sql
âŒ DILARANG menulis SQL DDL manual
âœ… SEMUA struktur database WAJIB mengikuti models.py FINAL di bawah
ğŸš¨ ATURAN PALING PENTING (WAJIB PATUH)
ğŸ”’ DATABASE & STRUKTUR TERKUNCI

models.py adalah SINGLE SOURCE OF TRUTH
Struktur folder DI BAWAH ini WAJIB diikuti
AI TIDAK BOLEH:
menambah / menghapus kolom
mengganti tipe data
mengganti nama tabel / field
menambah folder baru di luar struktur
Jika butuh logic tambahan â†’ buat di route / function,
âŒ BUKAN di models.py

ğŸ“ STRUKTUR FOLDER WAJIB
attendance-system/
â”‚
â”œâ”€â”€ app.py                     # Flask app utama (semua routes)
â”œâ”€â”€ config.py                  # Config DB, secret key, env
â”œâ”€â”€ models.py                  # ğŸ”’ DATABASE LOCKED
â”œâ”€â”€ face_engine.py             # OpenCV + MediaPipe (face & liveness)
â”œâ”€â”€ face_cache.py              # Cache encoding wajah (optional)
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ .env
â”‚
â”œâ”€â”€ migrations/                # AUTO (Flask-Migrate)
â”‚
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ camera.js
â”‚   â”‚   â”œâ”€â”€ geolocation.js
â”‚   â”‚   â””â”€â”€ dashboard.js
â”‚   â”‚
â”‚   â””â”€â”€ uploads/
â”‚       â”œâ”€â”€ profiles/
â”‚       â””â”€â”€ leaves/
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ login.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”œâ”€â”€ absen.html
â”‚   â”œâ”€â”€ register.html
â”‚   â”œâ”€â”€ izin_dashboard.html
â”‚   â””â”€â”€ shift_dashboard.html
â”‚
â”œâ”€â”€ dataset/                   # (Opsional) backup encoding wajah
â”‚
â””â”€â”€ README.md

ğŸ§± MODELS.PY FINAL (TIDAK BOLEH DIUBAH)
Gunakan schema berikut APA ADANYA.

from flask_sqlalchemy import SQLAlchemy
from datetime import datetime

db = SQLAlchemy()

class User(db.Model):
    __tablename__ = 'users'
    id = db.Column(db.Integer, primary_key=True)
    email = db.Column(db.String(191), unique=True, nullable=False)
    password_hash = db.Column(db.String(255), nullable=False)
    role = db.Column(db.Enum('OWNER'), default='OWNER', nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class ShiftSetting(db.Model):
    __tablename__ = 'shift_settings'
    id = db.Column(db.Integer, primary_key=True)
    nama = db.Column(db.String(64), unique=True, nullable=False)
    jam_masuk = db.Column(db.Time, nullable=False)
    jam_pulang = db.Column(db.Time, nullable=False)
    toleransi_menit = db.Column(db.Integer, default=5)
    aktif = db.Column(db.Boolean, default=True)
    dibuat = db.Column(db.DateTime, default=datetime.utcnow)

class Employee(db.Model):
    __tablename__ = 'employees'
    id = db.Column(db.Integer, primary_key=True)
    kode = db.Column(db.String(64), unique=True, nullable=False)
    nama = db.Column(db.String(191), nullable=False)
    email = db.Column(db.String(191))
    shift_id = db.Column(db.Integer, db.ForeignKey('shift_settings.id'))
    aktif = db.Column(db.Boolean, default=True)
    foto_profil = db.Column(db.String(255))
    dibuat = db.Column(db.DateTime, default=datetime.utcnow)

class FaceEncoding(db.Model):
    __tablename__ = 'face_encodings'
    id = db.Column(db.Integer, primary_key=True)
    employee_id = db.Column(db.Integer, db.ForeignKey('employees.id'), unique=True, nullable=False)
    encoding = db.Column(db.JSON, nullable=False)
    dibuat = db.Column(db.DateTime, default=datetime.utcnow)

class Attendance(db.Model):
    __tablename__ = 'attendances'
    __table_args__ = (
        db.UniqueConstraint('employee_id', 'tanggal', name='unique_daily_attendance'),
        db.Index('idx_attendance_tanggal', 'tanggal'),
    )

    id = db.Column(db.Integer, primary_key=True)
    employee_id = db.Column(db.Integer, db.ForeignKey('employees.id'), nullable=False)
    tanggal = db.Column(db.Date, nullable=False)
    check_in = db.Column(db.Time)
    check_out = db.Column(db.Time)
    status = db.Column(db.Enum('HADIR','TERLAMBAT','IZIN','ALPA','DITOLAK'), nullable=False)
    latitude = db.Column(db.Float)
    longitude = db.Column(db.Float)
    liveness_ok = db.Column(db.Boolean, default=False)
    similarity = db.Column(db.Float)
    dibuat = db.Column(db.DateTime, default=datetime.utcnow)

class LeaveRequest(db.Model):
    __tablename__ = 'leave_requests'
    __table_args__ = (
        db.Index('idx_leave_tanggal', 'tanggal_mulai', 'tanggal_selesai'),
    )

    id = db.Column(db.Integer, primary_key=True)
    employee_id = db.Column(db.Integer, db.ForeignKey('employees.id'), nullable=False)
    alasan = db.Column(db.String(255), nullable=False)
    tanggal_mulai = db.Column(db.Date, nullable=False)
    tanggal_selesai = db.Column(db.Date, nullable=False)
    bukti_foto = db.Column(db.String(255))
    status = db.Column(db.Enum('PENDING','DISETUJUI','DITOLAK'), default='PENDING')
    dibuat = db.Column(db.DateTime, default=datetime.utcnow)

ğŸ§  FACE ENGINE RULES
Gunakan OpenCV + MediaPipe
Jangan simpan foto mentah
Gunakan 128-D facial encodings
Cocokkan wajah < 1 detik
Return:
employee_id
similarity
liveness_ok

ğŸ“¦ MODUL WAJIB (TIDAK BOLEH DIUBAH)
Login Owner
Registrasi wajah karyawan
Absensi real-time
Liveness detection
Geofencing GPS (50m)
Dashboard statistik
CRUD karyawan
Izin & cuti
Export Excel / PDF
Pengaturan shift

ğŸ›‘ JIKA MELANGGAR
Jika AI:
mengubah schema
mengubah struktur folder
menambah file tidak diminta

â¡ï¸ OUTPUT DIANGGAP SALAH
ğŸ¯ TARGET

Kode production-ready, bukan tutorial.